import{l as D}from"./index-DdI-Egwi.js";import{_ as H,k as M}from"./_plugin-vue_export-helper-fxonzzrb.js";import{k as W,m as j,n as G,o as u,c as r,a as n,b as a,w as _,p as V,F as x,y as C,e as d,r as g,x as S,L as J,s as K,i as z,t as c,q as N}from"./index-DcRigyih.js";const O={class:"logs-view"},P={class:"section-card"},Q={class:"logs-header"},X={class:"logs-actions"},Y={key:0,class:"empty-hint"},Z={class:"log-time"},$={key:0,class:"log-tag"},ee={class:"log-msg"},le={__name:"AccountLogs",props:{uin:String},setup(B){const i=B,s=d([]),b=d(!0),v=d(null),m=d(""),f=d("");let o=null;const F=S(()=>{const l=new Set;for(const e of s.value)e.tag&&l.add(e.tag);return[...l].sort()}),w=S(()=>s.value.filter(l=>!(m.value&&l.tag!==m.value||f.value&&l.level!==f.value)));function T(l){if(!l)return"";if(l.level==="error")return"log-error";if(l.level==="warn")return"log-warn";const e=(l.msg||"").toLowerCase();return e.includes("错误")||e.includes("失败")?"log-error":e.includes("成功")||e.includes("收获")||e.includes("偷")?"log-success":""}function y(l){return l==="error"?"ERR":l==="warn"?"WRN":"INF"}function h(){!b.value||!v.value||J(()=>{v.value.scrollTop=v.value.scrollHeight})}function I(){s.value=[]}async function k(){try{const l=await M(i.uin);s.value=l.data||[],h()}catch{}}function R(){const l=window.location.protocol+"//"+window.location.hostname+":3000";o=D(l,{transports:["websocket"]}),o.on("connect",()=>{o.emit("logs:subscribe",i.uin)}),o.on("bot:log",e=>{String(e.userId)===String(i.uin)&&(s.value.push(e),s.value.length>2e3&&(s.value=s.value.slice(-1500)),h())}),o.on("logs:history",e=>{String(e.uin)===String(i.uin)&&(s.value=e.logs||[],h())})}return W(()=>i.uin,(l,e)=>{s.value=[],o&&o.connected&&(e&&o.emit("logs:unsubscribe",e),o.emit("logs:subscribe",l)),k()}),j(()=>{k(),R()}),G(()=>{o&&(o.emit("logs:unsubscribe",i.uin),o.disconnect(),o=null)}),(l,e)=>{const p=g("el-option"),L=g("el-select"),U=g("el-switch"),A=g("el-button"),E=g("el-tag");return u(),r("div",O,[n("div",P,[n("div",Q,[e[4]||(e[4]=n("h3",{class:"section-title"},"运行日志",-1)),n("div",X,[a(L,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=t=>m.value=t),placeholder:"全部分类",clearable:"",size:"small",style:{width:"130px"}},{default:_(()=>[(u(!0),r(x,null,C(F.value,t=>(u(),K(p,{key:t,label:t,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(L,{modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=t=>f.value=t),placeholder:"全部级别",clearable:"",size:"small",style:{width:"110px"}},{default:_(()=>[a(p,{label:"ℹ️ 信息",value:"info"}),a(p,{label:"⚠️ 警告",value:"warn"}),a(p,{label:"❌ 错误",value:"error"})]),_:1},8,["modelValue"]),a(U,{modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=t=>b.value=t),"active-text":"自动滚动","inactive-text":"",size:"small"},null,8,["modelValue"]),a(A,{size:"small",onClick:I},{default:_(()=>[...e[3]||(e[3]=[z("清空",-1)])]),_:1}),a(E,{size:"small",type:"info"},{default:_(()=>[z(c(w.value.length)+" 条",1)]),_:1})])]),n("div",{class:"log-container",ref_key:"logContainer",ref:v},[w.value.length===0?(u(),r("div",Y,"暂无日志")):V("",!0),(u(!0),r(x,null,C(w.value,(t,q)=>(u(),r("div",{key:q,class:N(["log-line",T(t)])},[n("span",Z,c(t.time||""),1),n("span",{class:N(["log-level-badge","badge-"+t.level])},c(y(t.level)),3),t.tag?(u(),r("span",$,c(t.icon||"")+" "+c(t.tag),1)):V("",!0),n("span",ee,c(t.msg||""),1)],2))),128))],512)])])}}},ne=H(le,[["__scopeId","data-v-5dd8806f"]]);export{ne as default};
